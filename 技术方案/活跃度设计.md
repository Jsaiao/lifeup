# 活跃度设计

## V1-2019/12/08

`team_task` 表增加 `team_rank` 字段

活跃度值 = 总动态数 * 4 + 团队成员数 * 2 + 创建者过去30天总动态数 * 1 + 创建者过去30天参与团队数 * 1

缩减机制：每天减少 5 %，直到活跃值等于 0；

### 业务场景

* 创建团队

  1 * 4 + 1 * 2 + 创建者过去30天总动态数 * 1 +  创建者过去30天参与团队数 * 1

* 加入团队

  1 * 4 + 1 * 2

* 发表动态

  1 * 4

### 如何接入该功能

1.初始化：

遍历 team_task 表，获取 team_id

​	根据 team_id 查 team _member 表求团队成员数 * 1

​	根据 team_id 查 team_member_record 表求团队成员动态数 * 4

​	根据 user_id 查 team_member_record 表求过去 30 天创建者发表动态数 * 2

​	根据 user_id 查 team_member 表求过去 30 天创建者参与团队数 * 1

​	计算出 team_rank 值更新到 team_task 表

2.异步任务：每次发表动态时异步更新团队活跃度

3.缩减机制：定时器实现。

### 稳定性

​	考虑异步任务成功率

​	// TODO

### 改进

​	// TODO

​	活跃度引入点赞量作为参照

​	缩减机制引入举报作为参照